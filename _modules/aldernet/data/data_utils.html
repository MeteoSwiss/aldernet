
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>aldernet.data.data_utils &#8212; Aldernet 0.1.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/alabaster.css" />
    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/sphinx_highlight.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for aldernet.data.data_utils</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;Helper functions to import and pre-process zarr archives.&quot;&quot;&quot;</span>

<span class="c1"># Standard library</span>
<span class="kn">import</span> <span class="nn">math</span>

<span class="c1"># Third-party</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>  <span class="c1"># type: ignore</span>


<div class="viewcode-block" id="Params"><a class="viewcode-back" href="../../../modules.html#aldernet.data.data_utils.Params">[docs]</a><span class="k">class</span> <span class="nc">Params</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Retrieve selected weather parameters.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Define required data.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;CORY&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;ALNU&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">weather</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;CORYctsum&quot;</span><span class="p">,</span>
            <span class="s2">&quot;CORYfe&quot;</span><span class="p">,</span>
            <span class="s2">&quot;CORYfr&quot;</span><span class="p">,</span>
            <span class="s2">&quot;CORYrprec&quot;</span><span class="p">,</span>
            <span class="s2">&quot;CORYsaisn&quot;</span><span class="p">,</span>
            <span class="s2">&quot;CORYsdes&quot;</span><span class="p">,</span>
            <span class="s2">&quot;cos_dayofyear&quot;</span><span class="p">,</span>
            <span class="s2">&quot;cos_hourofday&quot;</span><span class="p">,</span>
            <span class="s2">&quot;FIS&quot;</span><span class="p">,</span>
            <span class="s2">&quot;HPBL&quot;</span><span class="p">,</span>
            <span class="s2">&quot;HSURF&quot;</span><span class="p">,</span>
            <span class="s2">&quot;QR&quot;</span><span class="p">,</span>
            <span class="s2">&quot;P&quot;</span><span class="p">,</span>
            <span class="s2">&quot;sin_dayofyear&quot;</span><span class="p">,</span>
            <span class="s2">&quot;sin_hourofday&quot;</span><span class="p">,</span>
            <span class="s2">&quot;TQC&quot;</span><span class="p">,</span>
            <span class="s2">&quot;U&quot;</span><span class="p">,</span>
            <span class="s2">&quot;V&quot;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">combined</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">weather</span></div>


<div class="viewcode-block" id="Stations"><a class="viewcode-back" href="../../../modules.html#aldernet.data.data_utils.Stations">[docs]</a><span class="k">class</span> <span class="nc">Stations</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Retrieve the measurement stations.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Define required data.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grids</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;grid_i&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="mi">525</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
                <span class="mi">511</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
                <span class="mi">651</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
                <span class="mi">677</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
                <span class="mi">420</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
                <span class="mi">472</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
                <span class="mi">456</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
                <span class="mi">603</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
                <span class="mi">614</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
                <span class="mi">570</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
                <span class="mi">636</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
                <span class="mi">479</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
                <span class="mi">540</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
                <span class="mi">590</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
            <span class="p">],</span>
            <span class="s2">&quot;grid_j&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="mi">506</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
                <span class="mi">444</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
                <span class="mi">465</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
                <span class="mi">429</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
                <span class="mi">373</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
                <span class="mi">463</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
                <span class="mi">405</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
                <span class="mi">365</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
                <span class="mi">349</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
                <span class="mi">455</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
                <span class="mi">510</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
                <span class="mi">451</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
                <span class="mi">379</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
                <span class="mi">485</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
            <span class="p">],</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;PBS&quot;</span><span class="p">,</span>
            <span class="s2">&quot;PBE&quot;</span><span class="p">,</span>
            <span class="s2">&quot;PBU&quot;</span><span class="p">,</span>
            <span class="s2">&quot;PDS&quot;</span><span class="p">,</span>
            <span class="s2">&quot;PGE&quot;</span><span class="p">,</span>
            <span class="s2">&quot;PCF&quot;</span><span class="p">,</span>
            <span class="s2">&quot;PLS&quot;</span><span class="p">,</span>
            <span class="s2">&quot;PLO&quot;</span><span class="p">,</span>
            <span class="s2">&quot;PLU&quot;</span><span class="p">,</span>
            <span class="s2">&quot;PLZ&quot;</span><span class="p">,</span>
            <span class="s2">&quot;PMU&quot;</span><span class="p">,</span>
            <span class="s2">&quot;PNE&quot;</span><span class="p">,</span>
            <span class="s2">&quot;PVI&quot;</span><span class="p">,</span>
            <span class="s2">&quot;PZH&quot;</span><span class="p">,</span>
        <span class="p">]</span></div>


<div class="viewcode-block" id="Batcher"><a class="viewcode-back" href="../../../modules.html#aldernet.data.data_utils.Batcher">[docs]</a><span class="k">class</span> <span class="nc">Batcher</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">Sequence</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Generates data for Keras.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">,</span> <span class="n">add_weather</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">Params</span><span class="p">()</span><span class="o">.</span><span class="n">x</span><span class="p">]</span><span class="o">.</span><span class="n">to_array</span><span class="p">(</span><span class="s2">&quot;var&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="s2">&quot;valid_time&quot;</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="s2">&quot;var&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">add_weather</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">weather</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">data</span><span class="p">[</span><span class="n">Params</span><span class="p">()</span><span class="o">.</span><span class="n">weather</span><span class="p">]</span>
                <span class="o">.</span><span class="n">to_array</span><span class="p">(</span><span class="s2">&quot;var&quot;</span><span class="p">)</span>
                <span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="s2">&quot;valid_time&quot;</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="s2">&quot;var&quot;</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">Params</span><span class="p">()</span><span class="o">.</span><span class="n">y</span><span class="p">]</span><span class="o">.</span><span class="n">to_array</span><span class="p">(</span><span class="s2">&quot;var&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="s2">&quot;valid_time&quot;</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="s2">&quot;var&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span> <span class="o">=</span> <span class="n">batch_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_weather</span> <span class="o">=</span> <span class="n">add_weather</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shuffle</span> <span class="o">=</span> <span class="n">shuffle</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">on_epoch_end</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Denotes the number of batches per epoch.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generate one batch of data.&quot;&quot;&quot;</span>
        <span class="n">batch_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">idx</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span> <span class="p">:</span> <span class="p">(</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span><span class="p">]</span>
        <span class="n">batch_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">idx</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span> <span class="p">:</span> <span class="p">(</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_weather</span><span class="p">:</span>
            <span class="n">batch_weather</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">weather</span><span class="p">[</span>
                <span class="n">idx</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span> <span class="p">:</span> <span class="p">(</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span>
            <span class="p">]</span>
            <span class="k">return</span> <span class="n">batch_x</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">batch_weather</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">batch_y</span><span class="o">.</span><span class="n">values</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">batch_x</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">batch_y</span><span class="o">.</span><span class="n">values</span>

<div class="viewcode-block" id="Batcher.on_epoch_end"><a class="viewcode-back" href="../../../modules.html#aldernet.data.data_utils.Batcher.on_epoch_end">[docs]</a>    <span class="k">def</span> <span class="nf">on_epoch_end</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Update indexes after each epoch.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shuffle</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">permutation</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_weather</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">weather</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">weather</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Data Reshuffled!&quot;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div></div>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../index.html">Aldernet</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../readme.html">Aldernet</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../modules.html">Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../authors.html">Credits</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../history.html">History</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation overview</a><ul>
  <li><a href="../../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, MeteoSwiss.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 5.3.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    

    
  </body>
</html>